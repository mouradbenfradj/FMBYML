<?php

namespace SS\FMBBundle\Repository;

use Doctrine\ORM\EntityRepository;
use SS\FMBBundle\Entity\Magasins;

/**
 * FiliereRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class FiliereRepository extends EntityRepository
{
    public function getTotaleContenuFiliere(Magasins $parc)
    {
        $qb = $this->createQueryBuilder('fi')
            ->select('fl.id as flId')->addSelect('fi.observation as observation')
            ->addSelect('s.id as sId')->addSelect('s.nomSegment')->addSelect('s.longeur')
            ->addSelect('fl.nomFlotteur')->addSelect('fi.nomFiliere')->addSelect('fi.id as fiId')->addSelect('fi.aireDeTravaille')
            ->addSelect('e.dateDeRemplissage as dateDeRemplissage')->addSelect('e.id as empId')->addSelect('e.place')
            ->addSelect('c.id as sc')->addSelect('c.chaussement as chausc')->addSelect('c.dateDeMAETransfert as maect')->addSelect('c.quantiter as qtec')
            ->addSelect('lan.id as sl')->addSelect('lan.chaussement as chausl')->addSelect('lan.dateDeMAETransfert as maelt')
            ->addSelect('lanter.nomLanterne')->addSelect('lanter.nbrpoche')->addSelect('lart.numeroSerie as numeroSerieLanrt')
            ->addSelect('poch.quantite as qte')->addSelect('spchbs.dateDeMAETransfert as maept')->addSelect('spchbs.chaussement as chausp')->addSelect('spchbs.id as sp')
            ->addSelect('carticle.numeroSerie as numeroSerie ')
            ->addSelect('cord.nomCorde')
            ->addSelect('refa.libArticle as libArticle')
            ->addSelect('reflart.libArticle as llibArticle')
            ->addSelect('part.numeroSerie as numeroSeriePoche')
            ->addSelect('refpart.libArticle as plibArticle')
            ->join('fi.segments', 's')->join('s.flotteurs', 'fl')->join('fl.emplacements', 'e')
            ->leftJoin('e.stockslanterne', 'lan')->leftJoin('e.stockscorde', 'c')->leftJoin('e.stockspoches', 'spchbs')
            ->leftJoin('spchbs.pochesbs', 'pchbs')->leftJoin('spchbs.article','part')
            ->leftJoin('part.refStockArticle','refpsart')->leftJoin('refpsart.refArticle','refpart')
            ->leftJoin('lan.lanterne', 'lanter')->leftJoin('lan.poches', 'poch')->leftJoin('lan.article', 'lart')
            ->leftJoin('lart.refStockArticle', 'reflsart')->leftJoin('reflsart.refArticle', 'reflart')
            ->leftJoin('c.corde', 'cord')->leftJoin('c.article', 'carticle')
            ->leftJoin('carticle.refStockArticle', 'refsa')
            ->leftJoin('refsa.refArticle', 'refa')

            ->where('fi.parc = :parc')
            ->orderBy('fi.nomFiliere', 'ASC')
            ->setParameter('parc', $parc);
        return $qb->getQuery()->getResult();
    }
}
