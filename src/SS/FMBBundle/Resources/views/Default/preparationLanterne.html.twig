{% extends "::base.html.twig" %}
{% block title %}{{ parent() }} - FMB{% endblock %}
{% block stylesheet %}
    {{ parent() }}
    <link href="{{ asset('bundles/ssfmb/plugins/timepicker/bootstrap-timepicker.min.css') }}" rel="stylesheet">
    <link href="{{ asset('bundles/ssfmb/plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css') }}"
          rel="stylesheet">
    <link href="{{ asset('bundles/ssfmb/plugins/bootstrap-datepicker/css/bootstrap-datepicker.min.css') }}"
          rel="stylesheet">
    <link href="{{ asset('bundles/ssfmb/plugins/clockpicker/css/bootstrap-clockpicker.min.css') }}" rel="stylesheet">
    <link href="{{ asset('bundles/ssfmb/plugins/bootstrap-daterangepicker/daterangepicker.css') }}" rel="stylesheet">
    <link href="{{ asset('bundles/ssfmb/plugins/bootstrap-tagsinput/css/bootstrap-tagsinput.css') }}" rel="stylesheet"/>
    <link href="{{ asset('bundles/ssfmb/plugins/switchery/css/switchery.min.css') }}" rel="stylesheet"/>
    <link href="{{ asset('bundles/ssfmb/plugins/multiselect/css/multi-select.css') }}" rel="stylesheet"
          type="text/css"/>
    <link href="{{ asset('bundles/ssfmb/plugins/ladda-buttons/css/ladda-themeless.min.css') }}" rel="stylesheet"
          type="text/css"/>

    <link href="{{ asset('bundles/ssfmb/plugins/select2/css/select2.min.css') }}" rel="stylesheet" type="text/css"/>
    <link href="{{ asset('bundles/ssfmb/plugins/bootstrap-select/css/bootstrap-select.min.css') }}" rel="stylesheet"/>
    <link href="{{ asset('bundles/ssfmb/plugins/bootstrap-touchspin/css/jquery.bootstrap-touchspin.min.css') }}"
          rel="stylesheet"/>


{% endblock %}
{% block header %} {{ parent() }}{% endblock %}
{% block body %}
    {{ parent() }}
    {% set page = 'PrLn' %}
    <div class="row">
        <div class="col-sm-12">
            <div class="card-box">
                <div class="row">
                    <div class="col-md-6">
                        <h4 class="m-t-0 header-title"><b>Preparation Lanterne </b></h4>
                        <p class="text-muted m-b-30 font-13">
                        </p>
                        {{ form_start(form) }}
                        {{ form_errors(form) }}
                        <div class="form-group">
                            <div class="col-md-4">
                                {{ form_label(form.Parc) }}
                            </div>
                            <div class="col-md-8">
                                {{ form_widget(form.Parc) }}
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-4">
                                {{ form_label(form.libStock) }}
                            </div>
                            <div class="col-md-8">
                                <img src="{{ asset('bundles/ssfmb/images/stock.gif') }}" height="50" width="50"
                                     id="loadstock">
                                {{ form_widget(form.libStock) }}
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-4">
                                {{ form_label(form.nomLanterne) }}
                            </div>
                            <div class="col-md-8">
                                <img src="{{ asset('bundles/ssfmb/images/stock.gif') }}" height="50" width="50"
                                     id="loadlanterne">
                                {{ form_widget(form.nomLanterne) }}
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-4">
                                {{ form_label(form.quantiterEnStock) }}
                            </div>
                            <div class="col-md-8">
                                <img src="{{ asset('bundles/ssfmb/images/stock.gif') }}" height="50" width="50"
                                     id="loadqtelstock">
                                <div id="divqteenstocks">{{ form_widget(form.quantiterEnStock) }}</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-md-4">
                                {{ form_label(form.date) }}
                            </div>
                            <div class="col-md-8">
                                <div class="input-group">
                                    {{ form_widget(form.date) }}
                                    <span class="input-group-addon bg-custom b-0 text-white"><i
                                                class="icon-calender"></i></span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-4">
                                {{ form_label(form.refArticle) }}
                            </div>
                            <div class="col-md-8">
                                {{ form_widget(form.refArticle) }}
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-4">
                                {{ form_label(form.numeroSerie) }}
                            </div>
                            <div class="col-md-8">
                                <img src="{{ asset('bundles/ssfmb/images/stock.gif') }}" height="50" width="50"
                                     id="loadlot">
                                {{ form_widget(form.numeroSerie) }}
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-4">
                                {{ form_label(form.qte) }}
                            </div>
                            <div class="col-md-8">
                                <img src="{{ asset('bundles/ssfmb/images/stock.gif') }}" height="50" width="50"
                                     id="loadqte">
                                <input type="number" readonly="true" value="0" class="form-control" id="totalqte">
                                {{ form_widget(form.qte) }}
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-md-4">
                                {{ form_label(form.nombre) }}
                            </div>
                            <div class="col-md-8">
                                {{ form_widget(form.nombre,{'attr': {'class' : "form-control", 'onblur': 'if (this.value!=\'\') test()'} }) }}
                            </div>
                        </div>

                        <div class="col-sm-3 col-xs-6 col-md-2" style="float: right" id="envoie">
                            <div class="p-20">
                                <section class="progress-demo">
                                    <button class="ladda-button btn btn-primary" data-style="expand-right">
                                        <div id="cmptnombre">Valid√©</div>
                                    </button>
                                </section>
                            </div>
                        </div>
                        {{ form_end(form) }}
                    </div>
                    <div class="col-md-1">
                        <div class="custom-dd dd" id="nestable_list_1">
                        </div>
                    </div>

                    <!-- end col -->
                    <!-- end col -->
                </div> <!-- end row -->
            </div> <!-- end card-box -->
        </div> <!-- end col -->
    </div>
    <!-- end Row -->

    {% block footer %}
        {{ parent() }}
    {% endblock %}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/ssfmb/plugins/moment/moment.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/timepicker/bootstrap-timepicker.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-datepicker/js/bootstrap-datepicker.fr.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/clockpicker/js/bootstrap-clockpicker.min.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-daterangepicker/daterangepicker.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/pages/jquery.form-pickers.init.js') }}"></script>

    <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-tagsinput/js/bootstrap-tagsinput.min.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/switchery/js/switchery.min.js') }}"></script>
    <script type="text/javascript"
            src="{{ asset('bundles/ssfmb/plugins/multiselect/js/jquery.multi-select.js') }}"></script>
    <script type="text/javascript"
            src="{{ asset('bundles/ssfmb/plugins/jquery-quicksearch/jquery.quicksearch.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/select2/js/select2.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-select/js/bootstrap-select.min.js') }}"
            type="text/javascript"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-filestyle/js/bootstrap-filestyle.min.js') }}"
            type="text/javascript"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-touchspin/js/jquery.bootstrap-touchspin.min.js') }}"
            type="text/javascript"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-maxlength/bootstrap-maxlength.min.js') }}"
            type="text/javascript"></script>
    <script type="text/javascript"
            src="{{ asset('bundles/ssfmb/plugins/autocomplete/jquery.mockjax.js') }}"></script>
    <script type="text/javascript"
            src="{{ asset('bundles/ssfmb/plugins/autocomplete/jquery.autocomplete.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/ssfmb/plugins/autocomplete/countries.js') }}"></script>

    <script type="text/javascript" src="{{ asset('bundles/ssfmb/pages/jquery.form-advanced.init.js') }}"></script>

    <script src="{{ asset('bundles/ssfmb/plugins/ladda-buttons/js/spin.min.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/ladda-buttons/js/ladda.min.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/plugins/ladda-buttons/js/ladda.jquery.min.js') }}"></script>
    <script src="{{ asset('bundles/ssfmb/js/preparationlanterne.js') }}"></script>

    {# Voici le script en question : #}
    <script type="text/javascript">
        $(document).ready(function () {
            jQuery('#ss_fmbbundle_preparationlanterne_date').datepicker({language: 'fr'});
            jQuery('#ss_fmbbundle_preparationlanterne_Parc').ready(function () {
                var val = jQuery("#ss_fmbbundle_preparationlanterne_Parc").val();
                jQuery.ajax({
                    type: "POST",
                    url: "{{ url('ssfmb_parcstock') }}?parc_id=" + val,
                    complete: function () {
                        jQuery('#totalqte').ready(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                            jQuery('#totalqte').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#totalqte').change(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                    },
                    beforeSend: function () {
                        jQuery('#ss_fmbbundle_preparationlanterne_libStock').hide();
                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').hide();
                        jQuery('#ss_fmbbundle_preparationlanterne_qte').hide();
                        jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').hide()

                        jQuery('#envoie').hide();
                        jQuery('#totalqte').hide();
                        jQuery('#divqteenstocks').hide();
                        jQuery('#loadstock').show();
                    },
                    success: function (data) {
                        if (jQuery.trim(data)) {
                            jQuery('#ss_fmbbundle_preparationlanterne_libStock').show();
                            jQuery('#loadstock').hide();
                            // Remove current options
                            jQuery('#ss_fmbbundle_preparationlanterne_libStock').html('');
                            jQuery.each(data, function (k, v) {
                                jQuery('#ss_fmbbundle_preparationlanterne_libStock').append('<option value="' + v + '">' + k + '</option>');
                            });
                            jQuery.ajax({
                                type: "POST",
                                url: "{{ url('ssfmb_parclanterne') }}?parc_id=" + val,
                                complete: function () {
                                    jQuery('#totalqte').ready(function () {
                                        jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                    jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                                        jQuery('#totalqte').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                    jQuery('#totalqte').change(function () {
                                        jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                },
                                beforeSend: function () {
                                    jQuery('#loadlanterne').show();
                                    jQuery('#loadqtelstock').show();
                                },
                                success: function (data) {
                                    if (jQuery.trim(data)) {
                                        var pos = true;
                                        var lan = '';
                                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').show();
                                        jQuery('#loadlanterne').hide();
                                        jQuery('#loadqtelstock').hide();
                                        // Remove current options
                                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').html('');
                                        jQuery.each(data, function (k, v) {
                                            if (pos) {
                                                lan = k;
                                                jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').append('<option value="' + v + '">' + k + '</option>');
                                                pos = false;
                                            } else {
                                                if (jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').val() == lan) {
                                                    jQuery('#divqteenstocks').show();
                                                    jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val(v);
                                                }
                                                pos = true;
                                            }
                                        });
                                    }
                                }
                            });
                            jQuery.ajax({
                                type: "POST",
                                url: "{{ url('ssfmb_articlestock') }}?stock_id=" + jQuery('#ss_fmbbundle_preparationlanterne_libStock').val() + "&article=" + jQuery('#ss_fmbbundle_preparationlanterne_refArticle').val(),
                                beforeSend: function () {
                                    jQuery('#loadlot').show();
                                    jQuery('#loadqte').show();
                                },
                                complete: function () {
                                    jQuery('#totalqte').ready(function () {
                                        jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                    jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                                        jQuery('#totalqte').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                    jQuery('#totalqte').change(function () {
                                        jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                },
                                success: function (data) {
                                    if (jQuery.trim(data)) {
                                        var pos = true;
                                        var lan = '';
                                        jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').show();
                                        jQuery('#loadlot').hide();
                                        jQuery('#loadqte').hide();
                                        // Remove current options
                                        jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').html('');
                                        jQuery.each(data, function (k, v) {
                                            if (pos) {
                                                lan = k;
                                                jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').append('<option value="' + v + '">' + k + '</option>');
                                                pos = false;
                                            } else {
                                                if (jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').val() == lan) {
                                                    jQuery('#totalqte').show();
                                                    jQuery('#ss_fmbbundle_preparationlanterne_qte').show();
                                                    jQuery('#ss_fmbbundle_preparationlanterne_qte').val(0);
                                                    jQuery('#totalqte').val(v);
                                                }
                                                pos = true;
                                            }
                                        });
                                    }
                                }
                            });
                        }
                    }
                });
                return false;
            });
            jQuery('#ss_fmbbundle_preparationlanterne_refArticle').change(function () {
                jQuery.ajax({
                    type: "POST",
                    url: "{{ url('ssfmb_articlestock') }}?stock_id=" + jQuery('#ss_fmbbundle_preparationlanterne_libStock').val() + "&article=" + jQuery('#ss_fmbbundle_preparationlanterne_refArticle').val(),
                    beforeSend: function () {
                        jQuery('#ss_fmbbundle_preparationlanterne_qte').hide();
                        jQuery('#totalqte').hide();
                        jQuery('#envoie').hide();
                        jQuery('#loadlot').show();
                        jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').hide()
                        jQuery('#loadqte').show();
                    },
                    complete: function () {
                        jQuery('#loadlot').hide();
                        jQuery('#loadqte').hide();
                        jQuery('#totalqte').ready(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                            jQuery('#totalqte').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#totalqte').change(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                    },
                    success: function (data) {
                        if (jQuery.trim(data)) {
                            var pos = true;
                            var lan = '';
                            jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').show();
                            jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').html('');
                            jQuery.each(data, function (k, v) {
                                if (pos) {
                                    lan = k;
                                    jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').append('<option value="' + v + '">' + k + '</option>');
                                    pos = false;
                                } else {
                                    if (jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').val() == lan) {
                                        jQuery('#envoie').show();
                                        jQuery('#ss_fmbbundle_preparationlanterne_qte').show();
                                        jQuery('#totalqte').show();
                                        jQuery('#totalqte').val(v);
                                        jQuery('#ss_fmbbundle_preparationlanterne_qte').val(0);
                                    }
                                    pos = true;
                                }
                            });
                        }
                    }
                });
            });

            jQuery('#ss_fmbbundle_preparationlanterne_Parc').change(function () {
                jQuery('#ss_fmbbundle_preparationlanterne_libStock').hide();
                jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').hide();
                jQuery('#ss_fmbbundle_preparationlanterne_qte').hide();
                jQuery('#totalqte').hide();
                jQuery('#divqteenstocks').hide();
                jQuery('#envoie').hide();
                jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').hide()
                var val = jQuery(this).val();
                jQuery.ajax({
                    type: "POST",
                    url: "{{ url('ssfmb_parcstock') }}?parc_id=" + val,
                    complete: function () {
                        jQuery('#totalqte').ready(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                            jQuery('#totalqte').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#totalqte').change(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                    },
                    beforeSend: function () {
                        jQuery('#loadstock').show();
                        jQuery('#loadlanterne').show();
                        jQuery('#loadqtelstock').show();
                        jQuery('#loadlot').show();
                        jQuery('#loadqte').show();
                    },
                    success: function (data) {
                        if (jQuery.trim(data)) {
                            jQuery('#ss_fmbbundle_preparationlanterne_libStock').show();
                            jQuery('#loadstock').hide();
                            // Remove current options
                            jQuery('#ss_fmbbundle_preparationlanterne_libStock').html('');
                            jQuery.each(data, function (k, v) {
                                jQuery('#ss_fmbbundle_preparationlanterne_libStock').append('<option value="' + v + '">' + k + '</option>');
                            });
                            jQuery.ajax({
                                type: "POST",
                                url: "{{ url('ssfmb_parclanterne') }}?parc_id=" + val,
                                complete: function () {
                                    jQuery('#loadlanterne').hide();
                                    jQuery('#loadqtelstock').hide();
                                    jQuery('#totalqte').ready(function () {
                                        jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                    jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                                        jQuery('#totalqte').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                    jQuery('#totalqte').change(function () {
                                        jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });

                                },
                                success: function (data) {
                                    if (jQuery.trim(data)) {
                                        var pos = true;
                                        var lan = '';
                                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').show();

                                        // Remove current options
                                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').html('');
                                        jQuery.each(data, function (k, v) {
                                            if (pos) {
                                                lan = k;
                                                jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').append('<option value="' + v + '">' + k + '</option>');
                                                pos = false;
                                            } else {
                                                if (jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').val() == lan) {
                                                    jQuery('#divqteenstocks').show();
                                                    jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').show();
                                                    jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val(v);
                                                }
                                                pos = true;
                                            }
                                        });
                                    }
                                }
                            });
                            jQuery.ajax({
                                type: "POST",
                                url: "{{ url('ssfmb_articlestock') }}?stock_id=" + jQuery('#ss_fmbbundle_preparationlanterne_libStock').val() + "&article=" + jQuery('#ss_fmbbundle_preparationlanterne_refArticle').val(),
                                complete: function () {
                                    jQuery('#loadlot').hide();
                                    jQuery('#loadqte').hide();
                                    jQuery('#totalqte').ready(function () {
                                        jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                    jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                                        jQuery('#totalqte').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                    jQuery('#totalqte').change(function () {
                                        jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                            if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                                jQuery('#envoie').hide();
                                            } else {
                                                jQuery('#envoie').show();
                                            }
                                        });
                                    });
                                },
                                success: function (data) {
                                    if (jQuery.trim(data)) {
                                        var pos = true;
                                        var lan = '';
                                        jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').show();
                                        // Remove current options
                                        jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').html('');
                                        jQuery.each(data, function (k, v) {
                                            if (pos) {
                                                lan = k;
                                                jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').append('<option value="' + v + '">' + k + '</option>');
                                                pos = false;
                                            } else {
                                                if (jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').val() == lan) {
                                                    jQuery('#totalqte').show();
                                                    jQuery('#ss_fmbbundle_preparationlanterne_qte').show();
                                                    jQuery('#totalqte').val(v);
                                                    jQuery('#ss_fmbbundle_preparationlanterne_qte').val(0);
                                                }
                                                pos = true;

                                            }
                                        });
                                    }
                                }
                            });
                        }
                    }
                });
                return false;
            });
            jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                jQuery('#envoie').hide();
                jQuery('#divqteenstocks').hide();
                var val = jQuery("#ss_fmbbundle_preparationlanterne_Parc").val();

                jQuery.ajax({
                    type: "POST",
                    url: "{{ url('ssfmb_parclanterne') }}?parc_id=" + val,
                    beforeSend: function () {
                        jQuery('#loadqtelstock').show();
                    },
                    complete: function () {
                        jQuery('#loadqtelstock').hide();
                        jQuery('#totalqte').ready(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                            jQuery('#totalqte').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#totalqte').change(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                    },
                    success: function (data) {
                        if (jQuery.trim(data)) {
                            var pos = true;
                            var lan = '';
                            jQuery.each(data, function (k, v) {
                                if (pos) {
                                    lan = k;
                                    pos = false;
                                } else {
                                    if (jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').val() == lan) {
                                        jQuery('#divqteenstocks').show();
                                        jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val(v);
                                    }
                                    pos = true;
                                }
                            });
                        }
                    }
                });
            });

            jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').change(function () {
                jQuery('#envoie').hide();
                jQuery('#totalqte').hide();
                jQuery('#ss_fmbbundle_preparationlanterne_qte').hide();
                var val = jQuery("#ss_fmbbundle_preparationlanterne_Parc").val();

                jQuery.ajax({
                    type: "POST",
                    url: "{{ url('ssfmb_articlestocklot') }}?stock_id=" + jQuery('#ss_fmbbundle_preparationlanterne_libStock').val() + "&article=" + jQuery('#ss_fmbbundle_preparationlanterne_refArticle').val() + "&lot=" + jQuery('#ss_fmbbundle_preparationlanterne_numeroSerie').val(),
                    complete: function () {
                        jQuery('#totalqte').ready(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#ss_fmbbundle_preparationlanterne_nomLanterne').change(function () {
                            jQuery('#totalqte').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                        jQuery('#totalqte').change(function () {
                            jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').ready(function () {
                                if (jQuery('#totalqte').val() < 1 || jQuery('#ss_fmbbundle_preparationlanterne_quantiterEnStock').val() < 1) {
                                    jQuery('#envoie').hide();
                                } else {
                                    jQuery('#envoie').show();
                                }
                            });
                        });
                    },
                    beforeSend: function () {
                        jQuery('#loadqte').show();
                    },
                    success: function (data) {
                        if (jQuery.trim(data)) {
                            jQuery('#totalqte').show();
                            jQuery('#ss_fmbbundle_preparationlanterne_qte').show();
                            jQuery('#loadqte').hide();
                            // Remove current options
                            jQuery('#ss_fmbbundle_preparationlanterne_qte').html('');
                            jQuery.each(data, function (k, v) {
                                jQuery('#totalqte').val(v);
                                jQuery('#ss_fmbbundle_preparationlanterne_qte').val(0);
                            });
                        }
                    }
                });
            });
        });
    </script>
{% endblock %}