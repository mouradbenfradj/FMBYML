{% extends "SSFMBBundle::layout.html.twig" %}

{% block title %}
    Suivit - {{ parent() }}
{% endblock %}
{% block body %}
    <div class="container-fluid">
            {{ parent() }}
            <div class="row">
                <div class="col-md-12">
                    <form action="" method="post">
                        <ul class="pagination pagination-lg">

                            {% for page in pages %}

                                <li>
                                    <a href="{{ path('ssfmb_misaaeaucorde', { 'id': page.id }) }}">
                                        {{ page.nomParc }}
                                    </a>
                                </li>
                            {% endfor %}

                        </ul>
                        <table class="table table-condensed table-bordered" border="1">
                            <tbody>
                            {% for entity in entities %}
                                <tr>
                                    <td>
                                        <a href="{{ path('parc_show', { 'id': entity.id }) }}">
                                            {{ entity.nomParc }}
                                        </a>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <table class="table table-condensed table-bordered" border="1">
                                            <tbody>
                                            {% for filiere in entity.filieres %}
                                                <tr>
                                                    <td>{{ filiere.getNomFiliere }}
                                                        <br/>
                                                        {% set tailleFiliere =0 %}
                                                        {% for segment in filiere.segments %}
                                                            {% set tailleFiliere = tailleFiliere+segment.getLongeur %}
                                                        {% endfor %}
                                                        taille {{ tailleFiliere }} m
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <table class="table table-condensed table-bordered" border="1">
                                                            <tbody>
                                                            <tr>
                                                                {% for segment in filiere.segments %}
                                                                    <td valign="top">
                                                                        <ul>
                                                                            <li> {{ segment.getNomSegment }}</li>
                                                                            <li>{{ segment.getLongeur }} m</li>
                                                                        </ul>
                                                                        <table>
                                                                            {% for flotteur in segment.flotteurs %}
                                                                            <tr>
                                                                                <td>
                                                                                    <div id="{{ filiere.getNomFiliere }}{{ segment.getNomSegment }}{{ flotteur.getNomFlotteur }}">
                                                                                        {{ flotteur.getNomFlotteur }}|
                                                                                        {% set verifexsistance = 0 %}

                                                                                        {% for emplacement in flotteur.emplacements %}
                                                                                        {% if emplacement.corde == null and emplacement.stockslanterne == null %}
                                                                                            {% set verifexsistance =  verifexsistance + 1 %}

                                                                                            <font color="red"> {{ emplacement.place }}</font>
                                                                                            <input type="checkbox"
                                                                                                   name="placecorde[]"
                                                                                                   value="{{ emplacement.id }}"/>
                                                                                            <span style="display: none"
                                                                                                  id="dateemplacement">{{ emplacement.dateDeRemplissage|date('Y-m-d') }}</span>
                                                                                        {% elseif emplacement.corde != null %}
                                                                                            <a title="article  {{ emplacement.corde.article.lot.lot }}-{{ emplacement.corde.article.libArticle }}
-date de creation  {{ emplacement.corde.dateDeCreation|date('Y-m-d') }}
-date de MAE  {{ emplacement.dateDeRemplissage|date('Y-m-d') }}"
                                                                                               href="{{ path('corde_show', {'id': emplacement.corde.id }) }}">
                                                                                                <font color="blue"> {{ emplacement.place }}</font></a>
                                                                                            <span style="display: none"
                                                                                                  id="dateemplacement">{{ emplacement.dateDeRemplissage|date('Y-m-d') }}</span>

                                                                                        {% elseif emplacement.stockslanterne != null %}
                                                                                            <a title="{{ emplacement.stockslanterne.lanterne.nomlanterne }}
-article:{{ emplacement.stockslanterne.article.lot.lot }}-{{ emplacement.stockslanterne.article.libArticle }}
-date de creation  {{ emplacement.stockslanterne.dateDeCreation|date('Y-m-d') }}
-date de MAE  {{ emplacement.dateDeRemplissage|date('Y-m-d') }}"
                                                                                               href="{{ path('stockslanternes_show', {'id': emplacement.stockslanterne.id }) }}">
                                                                                                <font color="#adff2f"> {{ emplacement.place }}</font>
                                                                                            </a>
                                                                                            <span style="display: none"
                                                                                                  id="dateemplacement">{{ emplacement.dateDeRemplissage|date('Y-m-d') }}</span>

                                                                                        {% endif %}
                                                                                        {% endfor %}<br>
                                                                                        {% if verifexsistance != 0 %}
                                                                                            <input type="button"
                                                                                                   value="Tout cocher"
                                                                                                   onClick="fillCheckbox('{{ filiere.getNomFiliere }}{{ segment.getNomSegment }}{{ flotteur.getNomFlotteur }}','1');">&nbsp;&nbsp;
                                                                                            <input type="button"
                                                                                                   value="Tout dÃ©cocher"
                                                                                                   onClick="fillCheckbox('{{ filiere.getNomFiliere }}{{ segment.getNomSegment }}{{ flotteur.getNomFlotteur }}','0');">
                                                                                        {% endif %}
                                                                                        {% endfor %}
                                                                                    </div>
                                                                                </td>
                                                                            </tr>
                                                                        </table>
                                                                    </td>
                                                                {% endfor %}
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </td>
                                    <td>
                                        <p>quantiter disponible</p>
                                        <p><input type="number" id="quantit" readonly="true" value="0"></p>
                                        <p>date de preparation des cordes</p>
                                        {% set now =  "now"|date("Y-m-d") %}
                                        <p><input type="date" name="dateMAECorde" value="{{ now }}"></p>
                                        <p> choisir l'article a mettre</p>
                                        <p>
                                            <select name="articlechoix" id="articlechoix">
                                                {% for article in articles %}
                                                    <option value="{{ article.refArticle }}">{{ article.lot }}
                                                        -{{ article.libArticle }}</option>
                                                {% endfor %}
                                            </select>
                                        </p>
                                        <div id="choixqtearticle">
                                            <p> choix de la quantiter des corde</p>
                                            <p>
                                                <select name="quantierchoix" id="quantierchoix">
                                                </select>
                                            </p>
                                            <p><input type="submit" value="confirmer la mise a l'eau"/></p>

                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}

                            </tbody>
                        </table>
                    </form>
                </div>
            </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $(document).ready(function () {
            $('#choixqtearticle').ready(function () {
                $('#choixqtearticle').hide();
            });
            $('input:checkbox').change(function () {
                if ($(this).is(':checked')) {
                    $('#quantit').val(parseInt($('#quantit').val()) - 1);
                } else {
                    $('#quantit').val(parseInt($('#quantit').val()) + 1);
                }
            });
        });
        $('#articlechoix').ready(function () {
            $.ajax({
                type: 'get',
                url: "{{ path('ssfmb_cordearticle') }}",
                data: {'ida': $('#articlechoix').val()},
                dataType: 'json',

                beforeSend: function () {
                    $('#quantierchoix').empty();
                },
                success: function (json) {
                    $('#quantierchoix').html('');
                    if (!$.trim(json)) {
                        $('#choixqtearticle').ready(function () {
                            $('#choixqtearticle').hide();
                        });
                    };
                    if ($.trim(json)) {
                        $('#choixqtearticle').ready(function () {
                            $('#choixqtearticle').show();
                            $("input:checkbox").each(function () {
                                $(this).prop('checked', false);
                            });

                        });
                    };
                    $.each(json, function (index, value) {
                        $('#quantit').val(value.nombre);

                        $('#quantierchoix').append('<option value="' + value.qte + '">' + value.qte + '</option>');
                    });
                }
            });
        });
        $('#articlechoix').change(function () {
            $.ajax({
                type: 'get',
                url: "{{ path('ssfmb_cordearticle') }}",
                data: {'ida': $('#articlechoix').val()},
                dataType: 'json',
                beforeSend: function () {
                    $('#quantierchoix').empty();
                },
                success: function (json) {
                    $('#quantierchoix').html('');
                    if (!$.trim(json)) {
                        $('#choixqtearticle').ready(function () {
                            $('#choixqtearticle').hide();
                        });
                    }
                    if ($.trim(json)) {
                        $('#choixqtearticle').ready(function () {
                            $("input:checkbox").each(function () {
                                $(this).prop('checked', false);
                            });
                            $('#choixqtearticle').show();
                        });
                    }
                    $.each(json, function (index, value) {
                        $('#quantit').val(value.nombre);
                        $("input:checkbox").each(function () {
                            $(this).attr('checked', false);
                        });
                        $('#quantierchoix').append('<option value="' + value.qte + '">' + value.qte + '</option>');
                    });
                }
            });
        });
        function fillCheckbox(containerID, fill) {
            console.log(containerID);
            console.log(fill);
            var checkbox = $('#' + containerID);
            var checkbox = checkbox.find('input[type="checkbox"]');
            console.log(checkbox);

            checkbox.each(function () {
                switch (fill) {
                    case '0':
                        if (this.checked == true)
                            $('#quantit').val(parseInt($('#quantit').val()) + 1);
                        this.checked = false;
                        break;
                    case '1':
                        if (this.checked == false)
                            $('#quantit').val(parseInt($('#quantit').val()) - 1);
                        this.checked = true;
                        break;
                    case 2:
                        console.log(fill);
                        this.checked = !this.checked;
                        break;
                }
            });
        }
    </script>
{% endblock %}
