{% extends "SSFMBBundle::layout.html.twig" %}

{% block title %}
    Suivit - {{ parent() }}
{% endblock %}
{% block body %}
    <div class="container-fluid" xmlns="http://www.w3.org/1999/html">
        {{ parent() }}

        <div class="row">
            <div class="col-md-12">
                <form action="" method="post" onsubmit="return validation()">
                    <ul class="pagination pagination-lg">
                        {{ knp_menu_render('SSFMBBundle:Builder:parcRCMenu') }}
                    </ul>
                    <table class="table table-condensed table-bordered" border="1">
                        <tbody>
                        <tr>
                            <td>
                                {% if(entity != null) %}
                                <div id="idstockparc" hidden="true">{{ entity.idStock.idStock }}</div>
                                <div id="idparc" hidden="true">{{ entity.idMagasin }}</div>
                                {{ entity.abrevMagasin }}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <table class="table table-condensed table-bordered" border="1">
                                    <tbody>
                                    {% for filiere in entity.filieres %}
                                        <tr>
                                            <td id="{{ filiere.nomFiliere }}">{{ filiere.nomFiliere }}
                                                <br/>
                                                {% set tailleFiliere =0 %}
                                                {% for segment in filiere.segments %}
                                                    {% set tailleFiliere = tailleFiliere+segment.getLongeur %}
                                                {% endfor %}
                                                taille {{ tailleFiliere }} m
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <table class="table table-condensed table-bordered" border="1">
                                                    <tbody>
                                                    <tr>
                                                        {% for segment in filiere.segments %}
                                                            <td valign="top">
                                                                <ul>
                                                                    <li> {{ segment.getNomSegment }}</li>
                                                                    <li>{{ segment.getLongeur }} m</li>
                                                                </ul>
                                                                <table border="1">
                                                                    {% for flotteur in segment.flotteurs %}
                                                                    <tr>
                                                                        <td>
                                                                            <div id="{{ filiere.getNomFiliere }}{{ segment.getNomSegment }}{{ flotteur.getNomFlotteur }}">
                                                                                {{ flotteur.getNomFlotteur }}|
                                                                                {% set verifexsistance = 0 %}

                                                                                {% for emplacement in flotteur.emplacements %}
                                                                                    {% if emplacement.stockscorde == null and emplacement.stockslanterne == null %}
                                                                                        <font color="red"> {{ emplacement.place }}</font>|
                                                                                    {% elseif emplacement.stockscorde != null %}
                                                                                        <a title="article: {{ emplacement.stockscorde.article.refStockArticle.refArticle.libArticle }}
-lot : {{ emplacement.stockscorde.article.numeroSerie }}
-processus : {% set difference = date("now").diff(date(emplacement.dateDeRemplissage)) %}{% if difference.m <=5 %}G{{ difference.m }}{% elseif difference.m <=9 %}{% set dif2 = 9- difference.m %}H{{ dif2 }}{% elseif difference.m ==10 %}H00{% else %}H000{% endif %}

-date de MAE :{{ emplacement.dateDeRemplissage|date('Y-m-d') }}"
                                                                                           href="">
                                                                                            <font color="blue"> {{ emplacement.place }}</font></a>
                                                                                        <input type="checkbox"
                                                                                               name="placecorde[]"
                                                                                               value="{{ emplacement.id }}"/>

                                                                                        {% set verifexsistance =  verifexsistance + 1 %}
                                                                                    {% elseif emplacement.stockslanterne != null %}
                                                                                        <a title="{{ emplacement.stockslanterne.lanterne.nomlanterne }}
-article: {{ emplacement.stockslanterne.article.refStockArticle.refArticle.libArticle }}
-lot : {{ emplacement.stockslanterne.article.numeroSerie }}
-processus : {% set difference = date("now").diff(date(emplacement.dateDeRemplissage)) %}PG{{ difference.m }}
-date de MAE :{{ emplacement.dateDeRemplissage|date('Y-m-d') }}"
                                                                                           href="#">
                                                                                            <font color="#adff2f"> {{ emplacement.place }}</font></a>|
                                                                                    {% endif %}
                                                                                {% endfor %}
                                                                                {% if verifexsistance != 0 %}
                                                                                    <br>
                                                                                    <input
                                                                                            type="button"
                                                                                            value="Tout cocher"
                                                                                            onClick="fillCheckbox('{{ filiere.getNomFiliere }}{{ segment.getNomSegment }}{{ flotteur.getNomFlotteur }}','1');">&nbsp;&nbsp;
                                                                                    <input type="button"
                                                                                           value="Tout dÃ©cocher"
                                                                                           onClick="fillCheckbox('{{ filiere.getNomFiliere }}{{ segment.getNomSegment }}{{ flotteur.getNomFlotteur }}','0');">
                                                                                {% endif %}

                                                                                {% endfor %}
                                                                            </div>
                                                                        </td>
                                                                    </tr>
                                                                </table>
                                                            </td>
                                                        {% endfor %}
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </td>
                            <td width="20%">
                                <div data-spy="affix" data-offset-top="60" data-offset-bottom="200" id="menuform">
                                    <p>
                                    <div><a href="#menuprincipale">menu</a></div>
                                    <div>Listez des filieres</div>
                                    {% for filiere in entity.filieres %}
                                        <span class="lienfiliereint">
                                            <a href="#{{ filiere.nomFiliere }}">{{ filiere.nomFiliere }}</a>
                                        </span>
                                    {% endfor %}
                                    </p>
                                    <p>date de retrait des cordes</p>
                                    {% set now =  "now"|date("Y-m-d") %}
                                    <p><input type="date" name="dateRetraitCorde" value="{{ now }}"></p>
                                    <p>quantiter retirer</p>
                                    <p><input type="number" id="quantit" readonly="true" value="0"></p>
                                    <p>stocks de reception</p>
                                    <p>
                                        <input type="text" name="stockchoix" hidden="true" id="stockchoix"
                                               value="{{ entity.idStock.idStock }}">
                                        <input type="text" readonly="true" value="{{ entity.idStock.libStock }}">
                                    </p>

                                    <p><input type="submit" value="confirmer le retrait"/></p>
                                </div>
                            </td>
                        </tr>
                        {% endif %}

                        </tbody>
                    </table>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        function validation() {
            alert("cette etape est en maintenance pour plus d'information veuillez nous contactez");
            return false;
        }
        $(document).ready(function () {
            alert('cette page est en maintenance la validation du retrait ne sera pas effectuer,' +
                    'vous ne pouvez que la consulter ');
            $('input:checkbox').change(
                    function () {
                        if ($(this).is(':checked')) {
                            $('#quantit').val(parseInt($('#quantit').val()) + 1);
                        } else {
                            $('#quantit').val(parseInt($('#quantit').val()) - 1);

                        }
                    });
        });
        function fillCheckbox(containerID, fill) {
            var checkbox = $('#' + containerID);
            var checkbox = checkbox.find('input[type="checkbox"]');
            checkbox.each(function () {
                switch (fill) {
                    case '0':
                        if (this.checked == true)
                            $('#quantit').val(parseInt($('#quantit').val()) - 1);
                        this.checked = false;
                        break;
                    case '1':
                        if (this.checked == false)
                            $('#quantit').val(parseInt($('#quantit').val()) + 1);
                        this.checked = true;
                        break;
                    case 2:
                        this.checked = !this.checked;
                        break;
                }
            });
        }
    </script>
{% endblock %}
