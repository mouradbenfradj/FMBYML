{% extends "SSFMBBundle::layout.html.twig" %}

{% block title %}
    Suivit - {{ parent() }}
{% endblock %}
{% block body %}
    <div class="container-fluid">

        {% block menu %}
            {{ parent() }}
        {% endblock %}
        <br><br>
        {% block alerte %}
            <div class="row">
                <div class="col-md-12">
                    <div class="alert alert-dismissable alert-danger" id="alerterouge" style="display: none">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
                            ×
                        </button>
                        <h4>
                            Alert!
                        </h4> <strong>Warning!</strong> l'article du parc nomparc de la filiere f1 contenu dans le
                        segment A
                        a
                        partir du flotteur A1 a l'emplacement 10 a depasser le temps prevue <a href="#"
                                                                                               class="alert-link">alert
                            link</a>
                    </div>
                    <div class="alert alert-dismissable alert-warning" id="alertejaune" style="display: none">

                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
                            ×
                        </button>
                        <h4>
                            Alert!
                        </h4> <strong>Warning!</strong> il reste 5 jours pour l'article du parc nomparc de la filiere f1
                        contenu
                        dans le segment A a partir du flotteur A1 a l'emplacement 5 <a href="#"
                                                                                       class="alert-link">alert
                            link</a>
                    </div>
                    <div class="alert alert-success alert-dismissable" id="alerteverte" style="display: none">

                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
                            ×
                        </button>
                        <h4>
                            Alert!
                        </h4> <strong>Warning!</strong> Best check yo self, you're not looking too good. <a href="#"
                                                                                                            class="alert-link">alert
                            link</a>
                    </div>
                </div>
            </div>
        {% endblock %}
        <br><br><br>
        {% block ssfmb_body %}
            <div class="row">
                <div class="col-md-12">

                    <ul class="pagination pagination-lg">

                        {% for page in pages %}

                            <li>
                                <a href="{{ path('ssfmb_homepage', { 'id': page.id }) }}">
                                    {{ page.nomParc }}
                                </a>
                            </li>
                        {% endfor %}

                    </ul>
                    <table class="table table-condensed table-bordered" border="1">
                        <tbody>
                        {% for entity in entities %}
                            <tr>
                                <td>
                                    <a href="{{ path('parc_show', { 'id': entity.id }) }}">
                                        {{ entity.nomParc }}
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <table class="table table-condensed table-bordered" border="1">
                                        <tbody>
                                        {% for filiere in entity.filieres %}
                                            <tr>
                                                <td>{{ filiere.getNomFiliere }}
                                                    <br/>
                                                    {% set tailleFiliere =0 %}
                                                    {% for segment in filiere.segments %}
                                                        {% set tailleFiliere = tailleFiliere+segment.getLongeur %}
                                                    {% endfor %}
                                                    taille {{ tailleFiliere }} m
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <table class="table table-condensed table-bordered" border="1">
                                                        <tbody>
                                                        <tr>
                                                            {% for segment in filiere.segments %}
                                                                <td valign="top">
                                                                    <ul>
                                                                        <li> {{ segment.getNomSegment }}</li>
                                                                        <li>{{ segment.getLongeur }} m</li>
                                                                    </ul>
                                                                    {% for flotteur in segment.flotteurs %}
                                                                        <p>    {{ flotteur.getNomFlotteur }}
                                                                            {% for emplacement in flotteur.emplacements %}
                                                                                {% if emplacement.corde == null and emplacement.stockslanterne == null %}
                                                                                    <font color="red"> {{ emplacement.place }}</font>
                                                                                {% elseif emplacement.corde != null %}
                                                                                    <font color="blue"> {{ emplacement.place }}</font>
                                                                                    {% if(emplacement.dateDeRemplissage != null) %}
                                                                                        <span class="dateemplacement"
                                                                                              style="display: none">{{ emplacement.dateDeRemplissage|date('Y-m-d') }}</span>
                                                                                    {% endif %}
                                                                                {% elseif emplacement.stockslanterne != null %}
                                                                                    <a title="{{ emplacement.stockslanterne.lanterne.nomlanterne }}
-article  {{ emplacement.stockslanterne.article.libArticle }}
-date de creation  {{ emplacement.stockslanterne.dateDeCreation|date('Y-m-d') }}
-date de MAE  {{ emplacement.dateDeRemplissage|date('Y-m-d') }}"
                                                                                       href="{{ path('stockslanternes_show', {'id': emplacement.stockslanterne.id }) }}"><font
                                                                                                color="#adff2f"> {{ emplacement.place }}</font></a>
                                                                                    <span style="display: none"
                                                                                          id="dateemplacement">{{ emplacement.dateDeRemplissage|date('Y-m-d') }}</span>

                                                                                {% endif %}
                                                                            {% endfor %}
                                                                        </p>
                                                                    {% endfor %}
                                                                </td>
                                                            {% endfor %}
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        {% endblock %}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">

        $(document).ready(function () {

//display:none
            $('.dateemplacement').each(function (ele, val) {
                var datejour = $(this).text().split("-");
                var Date1 = new Date(datejour[0], datejour[1] - 1, datejour[2]);
                var Date2 = new Date();

                function diffdate(d1, d2, u) {
                    div = 1
                    switch (u) {
                        case 's':
                            div = 1000;
                            break;
                        case 'm':
                            div = 1000 * 60
                            break;
                        case 'h':
                            div = 1000 * 60 * 60
                            break;
                        case 'd':
                            div = 1000 * 60 * 60 * 24
                            break;
                    }

                    var Diff = d2.getTime() - d1.getTime();
                    return Math.ceil((Diff / div))
                }


                if (0 < diffdate(Date1, Date2, 'd') < 10) {
                    $('#alertejaune').show();

                    $('#alertejaune2').clone().prependTo("#alertejaune");
                    $('#alertejaune2').show();

                }

                if (diffdate(Date1, Date2, 'd') <= 0) {
                    $('#alerterouge').show();
                }
            });

        });
    </script>
{% endblock %}
