{% extends "::base.html.twig" %}
{% block title %}
    Processus - {{ parent() }}
{% endblock %}
{% block stylesheet %}
    {% if(entity != null) %}
        <link href="{{ asset('bundles/ssfmb/plugins/footable/css/footable.core.css') }}" rel="stylesheet">
        <link href="{{ asset('bundles/ssfmb/plugins/bootstrap-select/css/bootstrap-select.min.css') }}"
              rel="stylesheet"/>
        <link href="{{ asset('bundles/ssfmb/plugins/nestable/jquery.nestable.css') }}" rel="stylesheet"/>
        <link href="{{ asset('bundles/ssfmb/css/backToTop.css') }}" rel="stylesheet"/>
        <link rel="stylesheet" href="{{ asset('bundles/ssfmb/plugins/morris/morris.css') }}">
        {{ parent() }}
    {% endif %}
{% endblock %}
{% block header %}
    {{ parent() }}
{% endblock %}
{% block body %}
    {{ parent() }}
    {% set page = 'suivit' %}
    {% if(entity != null) %}
        <div class="row">
            <div class="col-sm-12">
                <div class="card-box">
                    <div class="row">
                        <div class="col-md-12">
                            <h4 class="m-t-0 header-title">
                                <b>
                                    Processus de grocissement {{ entity.abrevMagasin }}
                                </b>
                            </h4>
                            <p class="text-muted m-b-30 font-13"></p>
                            {% set defId  = 0 %}
                            {% if(entity != null) %}
                                {% set dateRecherche = "now"|date("Y-m-d") %}
                                {# teste phahses#}
                                <div class="row">
                                    <div class="col-lg-12">
                                        {% for idPhase,phase in tableauDesProcessus %}
                                            <div class="portlet">
                                                <div class="portlet-heading bg-info">
                                                    <h3 class="portlet-title">
                                                        {{ phase.nomPhase }}
                                                    </h3>
                                                    <div class="portlet-widgets">
                                                        <a href="javascript:;" data-toggle="reload">
                                                            <i class="ion-refresh"></i>
                                                        </a>
                                                        <span class="divider"></span>
                                                        <a data-toggle="collapse"
                                                           data-parent="#accordion{{ idPhase }}"
                                                           href="#bg-info{{ idPhase }}">
                                                            <i class="ion-minus-round"></i>
                                                        </a>
                                                        <span class="divider"></span>
                                                        <a href="#" data-toggle="remove">
                                                            <i class="ion-close-round"></i>
                                                        </a>
                                                    </div>
                                                    <div class="clearfix"></div>
                                                </div>
                                                <div id="bg-info{{ idPhase }}" class="panel-collapse collapse in">
                                                    <div class="portlet-body">
                                                        <div class="row">
                                                            <div class="col-lg-12">
                                                                <div class="card-box">
                                                                    <table id="demo-foo-accordion-{{ idPhase }}"
                                                                           class="table m-b-0 toggle-arrow-tiny">
                                                                        <thead>
                                                                        <tr>
                                                                            <th data-toggle="true"> etape</th>
                                                                            <th>quantiter totale</th>
                                                                            <th data-hide="all"></th>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                        {% for processus in phase.processus %}
                                                                            {% for numCycle, cycle in processus.cycle %}
                                                                                {% if (cycle.quantiterLanterne + cycle.nombreLanterne + cycle.nombreCorde + cycle.quantiterCorde + cycle.nombrePoche + cycle.quantiterPoche ) != 0 %}
                                                                                    <tr>
                                                                                        <td>
                                                                                            {{ processus.nomProcessus }}{{ numCycle }}
                                                                                        </td>
                                                                                        <td>
                                                                                            {% if(cycle.quantiterLanterne  + cycle.nombreLanterne ) != 0 %}
                                                                                                <p>
                                                                                            <span id="{{ processus.nomProcessus }}{{ numCycle }}"
                                                                                                  value="{{ cycle.quantiterLanterne }}">
                                                                                                {{ cycle.quantiterLanterne|number_format(0, ',', '.') }}
                                                                                                <input type="hidden"
                                                                                                       value="{{ phase.nomPhase }}"
                                                                                                       class="phase"
                                                                                                       name="phase[]">
                                                                                                <input type="hidden"
                                                                                                       value="{{ processus.nomProcessus }}{{ numCycle }}"
                                                                                                       class="processus"
                                                                                                       name="processus[]">
                                                                                                <input type="hidden"
                                                                                                       value="{{ cycle.quantiterLanterne|number_format(0, ',', '.') }}"
                                                                                                       class="processusqte"
                                                                                                       name="processusqte[]">
                                                                                            </span>
                                                                                                    u<br>
                                                                                                    {{ (cycle.quantiterLanterne /12)|number_format(2, ',', '.') }}
                                                                                                    dz<br>
                                                                                                    {{ ((cycle.quantiterLanterne /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                    (dz * 0.533)
                                                                                                    <br>
                                                                                                    {{ cycle.nombreLanterne }}
                                                                                                    lanterne
                                                                                                </p>
                                                                                            {% endif %}
                                                                                            {% if(cycle.quantiterCorde  + cycle.nombreCorde ) != 0 %}
                                                                                                <p>
                                                                                                    <input type="hidden"
                                                                                                           value="{{ phase.nomPhase }}"
                                                                                                           class="phase"
                                                                                                           name="phase[]">
                                                                                                    <input type="hidden"
                                                                                                           value="{{ processus.nomProcessus }}{{ numCycle }}"
                                                                                                           class="processus"
                                                                                                           name="processus[]">
                                                                                                    <input type="hidden"
                                                                                                           value="{{ cycle.quantiterCorde|number_format(0, ',', '.') }}"
                                                                                                           class="processusqte"
                                                                                                           name="processusqte[]">
                                                                                                    {{ cycle.quantiterCorde|number_format(0, ',', '.') }}
                                                                                                    u<br>
                                                                                                    {{ (cycle.quantiterCorde/12)|number_format(2, ',', '.') }}
                                                                                                    dz<br>
                                                                                                    {{ ((cycle.quantiterCorde /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                    (dz * 0.533)<br>
                                                                                                    {{ cycle.nombreCorde }}
                                                                                                    corde
                                                                                                </p>
                                                                                            {% endif %}
                                                                                            {% if(cycle.quantiterPoche  + cycle.nombrePoche ) != 0 %}
                                                                                                <p>
                                                                                                    <input type="hidden"
                                                                                                           value="{{ phase.nomPhase }}"
                                                                                                           class="phase"
                                                                                                           name="phase[]">
                                                                                                    <input type="hidden"
                                                                                                           value="{{ processus.nomProcessus }}{{ numCycle }}"
                                                                                                           class="processus"
                                                                                                           name="processus[]">
                                                                                                    <input type="hidden"
                                                                                                           value="{{ cycle.quantiterPoche|number_format(0, ',', '.') }}"
                                                                                                           class="processusqte"
                                                                                                           name="processusqte[]">
                                                                                                    {{ cycle.quantiterPoche|number_format(0, ',', '.') }}
                                                                                                    u<br>
                                                                                                    {{ (cycle.quantiterPoche/12)|number_format(2, ',', '.') }}
                                                                                                    dz<br>
                                                                                                    {{ ((cycle.quantiterPoche /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                    (dz * 0.533)<br>
                                                                                                    {{ cycle.nombrePoche }}
                                                                                                    poche
                                                                                                </p>
                                                                                            {% endif %}
                                                                                            {% set datemincordemae = null %}
                                                                                            {% set datemaxcordemae = null %}
                                                                                            {% set dateminlanternemae = null %}
                                                                                            {% set datemaxlanternemae = null %}
                                                                                            {% set dateminpochemae = null %}
                                                                                            {% set datemaxpochemae = null %}
                                                                                            {% for idFiliere, filiere in cycle.filiere %}
                                                                                                {% for idSegment,segment in filiere.segment %}
                                                                                                    {% for idFlotteur, flotteur in segment.flotteur %}
                                                                                                        {% for idEmplacement,emplacement in flotteur.emplacement %}
                                                                                                            {% if emplacement.stockslanterne %}
                                                                                                                {% if dateminlanternemae %}
                                                                                                                    {% if datemaxlanternemae < emplacement.dateDeRemplissage %}
                                                                                                                        {% set datemaxlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                    {% elseif dateminlanternemae > emplacement.dateDeRemplissage %}
                                                                                                                        {% set dateminlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                    {% endif %}
                                                                                                                {% else %}
                                                                                                                    {% set dateminlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                    {% set datemaxlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                {% endif %}
                                                                                                            {% elseif emplacement.stockscorde %}
                                                                                                                {% if emplacement.stockscorde.dateAssemblage %}
                                                                                                                    {% if dateminpochemae %}
                                                                                                                        {% if datemaxpochemae < emplacement.dateDeRemplissage %}
                                                                                                                            {% set datemaxpochemae = emplacement.dateDeRemplissage %}
                                                                                                                        {% elseif dateminpochemae > emplacement.dateDeRemplissage %}
                                                                                                                            {% set dateminpochemae = emplacement.dateDeRemplissage %}
                                                                                                                        {% endif %}
                                                                                                                    {% else %}
                                                                                                                        {% set dateminpochemae = emplacement.dateDeRemplissage %}
                                                                                                                        {% set datemaxpochemae = emplacement.dateDeRemplissage %}
                                                                                                                    {% endif %}
                                                                                                                {% else %}
                                                                                                                    {% if datemincordemae %}
                                                                                                                        {% if datemaxcordemae < emplacement.dateDeRemplissage %}
                                                                                                                            {% set datemaxcordemae = emplacement.dateDeRemplissage %}
                                                                                                                        {% elseif datemincordemae > emplacement.dateDeRemplissage %}
                                                                                                                            {% set datemincordemae = emplacement.dateDeRemplissage %}
                                                                                                                        {% endif %}
                                                                                                                    {% else %}
                                                                                                                        {% set datemincordemae = emplacement.dateDeRemplissage %}
                                                                                                                        {% set datemaxcordemae = emplacement.dateDeRemplissage %}
                                                                                                                    {% endif %}
                                                                                                                {% endif %}
                                                                                                            {% endif %}
                                                                                                        {% endfor %}
                                                                                                    {% endfor %}
                                                                                                {% endfor %}
                                                                                            {% endfor %}
                                                                                            {% if dateminlanternemae %}
                                                                                                <p>
                                                                                                MIN
                                                                                                date
                                                                                                MAE
                                                                                                Lanterne: {{ dateminlanternemae|date('Y-m-d') }}
                                                                                                <->
                                                                                                MAX
                                                                                                date
                                                                                                MAE
                                                                                                Lanterne: {{ datemaxlanternemae|date('Y-m-d') }}</p>{% endif %}
                                                                                            {% if datemincordemae %}
                                                                                                <p>
                                                                                                MIN
                                                                                                date
                                                                                                MAE
                                                                                                Corde: {{ datemincordemae|date('Y-m-d') }}
                                                                                                <->
                                                                                                MAX
                                                                                                date
                                                                                                MAE
                                                                                                Corde: {{ datemaxcordemae|date('Y-m-d') }}</p>{% endif %}
                                                                                            {% if dateminpochemae %}
                                                                                                <p>
                                                                                                MIN
                                                                                                date
                                                                                                MAE
                                                                                                Poche: {{ dateminpochemae|date('Y-m-d') }}
                                                                                                <->
                                                                                                MAX
                                                                                                date
                                                                                                MAE
                                                                                                Poche: {{ datemaxpochemae|date('Y-m-d') }}</p>{% endif %}
                                                                                        </td>
                                                                                        <td>
                                                                                            <div class="custom-dd dd"
                                                                                                 id="nestable_list_2">
                                                                                                <ol class="dd-list">
                                                                                                    {% for idFiliere, filiere in cycle.filiere %}
                                                                                                        <li class="dd-item"
                                                                                                            data-id="{{ loop.index0 }}">
                                                                                                            <div class="dd-handle"
                                                                                                                 id="{{ idFiliere }}">
                                                                                                                <p> {{ filiere.nomFiliere }}</p>
                                                                                                                {% if(filiere.quantiterLanterne  + filiere.nombreLanterne ) != 0 %}
                                                                                                                    <p>{{ filiere.quantiterLanterne|number_format(0, ',', '.') }}
                                                                                                                        u
                                                                                                                        / {{ filiere.nombreLanterne }}
                                                                                                                        lanterne</p>
                                                                                                                    <p>{{ (filiere.quantiterLanterne /12)|number_format(2, ',', '.') }}
                                                                                                                        dz</p>
                                                                                                                    <p>{{ ((cycle.quantiterLanterne /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                                        (dz
                                                                                                                        *
                                                                                                                        0.533)</p>
                                                                                                                {% endif %}
                                                                                                                {% if(filiere.quantiterCorde  + filiere.nombreCorde ) != 0 %}
                                                                                                                    <p>{{ filiere.quantiterCorde|number_format(0, ',', '.') }}
                                                                                                                        u
                                                                                                                        / {{ filiere.nombreCorde }}
                                                                                                                        corde</p>
                                                                                                                    <p>{{ (filiere.quantiterCorde/12)|number_format(2, ',', '.') }}
                                                                                                                        dz</p>
                                                                                                                    <p>{{ ((cycle.quantiterCorde /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                                        (dz
                                                                                                                        *
                                                                                                                        0.533)</p>
                                                                                                                {% endif %}
                                                                                                                {% if(filiere.quantiterPoche  + filiere.nombrePoche ) != 0 %}
                                                                                                                    <p>{{ filiere.quantiterPoche|number_format(0, ',', '.') }}
                                                                                                                        u
                                                                                                                        / {{ filiere.nombrePoche }}
                                                                                                                        poche</p>
                                                                                                                    <p>{{ (filiere.quantiterPoche/12)|number_format(2, ',', '.') }}
                                                                                                                        dz</p>
                                                                                                                    <p>{{ ((cycle.quantiterPoche /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                                        (dz
                                                                                                                        *
                                                                                                                        0.533)</p>
                                                                                                                {% endif %}
                                                                                                                {% set datemincordemae = null %}
                                                                                                                {% set datemaxcordemae = null %}
                                                                                                                {% set dateminlanternemae = null %}
                                                                                                                {% set datemaxlanternemae = null %}
                                                                                                                {% set dateminpochemae = null %}
                                                                                                                {% set datemaxpochemae = null %}
                                                                                                                {% for idSegment,segment in filiere.segment %}
                                                                                                                    {% for idFlotteur, flotteur in segment.flotteur %}
                                                                                                                        {% for idEmplacement,emplacement in flotteur.emplacement %}
                                                                                                                            {% if emplacement.stockslanterne %}
                                                                                                                                {% if dateminlanternemae %}
                                                                                                                                    {% if datemaxlanternemae < emplacement.dateDeRemplissage %}
                                                                                                                                        {% set datemaxlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                    {% elseif dateminlanternemae > emplacement.dateDeRemplissage %}
                                                                                                                                        {% set dateminlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                    {% endif %}
                                                                                                                                {% else %}
                                                                                                                                    {% set dateminlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                    {% set datemaxlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                {% endif %}
                                                                                                                            {% elseif emplacement.stockscorde %}
                                                                                                                                {% if emplacement.stockscorde.dateAssemblage %}
                                                                                                                                    {% if dateminpochemae %}
                                                                                                                                        {% if datemaxpochemae < emplacement.dateDeRemplissage %}
                                                                                                                                            {% set datemaxpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                        {% elseif dateminpochemae > emplacement.dateDeRemplissage %}
                                                                                                                                            {% set dateminpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                        {% endif %}
                                                                                                                                    {% else %}
                                                                                                                                        {% set dateminpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                        {% set datemaxpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                    {% endif %}
                                                                                                                                {% else %}
                                                                                                                                    {% if datemincordemae %}
                                                                                                                                        {% if datemaxcordemae < emplacement.dateDeRemplissage %}
                                                                                                                                            {% set datemaxcordemae = emplacement.dateDeRemplissage %}
                                                                                                                                        {% elseif datemincordemae > emplacement.dateDeRemplissage %}
                                                                                                                                            {% set datemincordemae = emplacement.dateDeRemplissage %}
                                                                                                                                        {% endif %}
                                                                                                                                    {% else %}
                                                                                                                                        {% set datemincordemae = emplacement.dateDeRemplissage %}
                                                                                                                                        {% set datemaxcordemae = emplacement.dateDeRemplissage %}
                                                                                                                                    {% endif %}
                                                                                                                                {% endif %}
                                                                                                                            {% endif %}
                                                                                                                        {% endfor %}
                                                                                                                    {% endfor %}
                                                                                                                {% endfor %}
                                                                                                                {% if dateminlanternemae %}
                                                                                                                    <p>
                                                                                                                    MIN
                                                                                                                    date
                                                                                                                    MAE
                                                                                                                    Lanterne: {{ dateminlanternemae|date('Y-m-d') }}
                                                                                                                    <->
                                                                                                                    MAX
                                                                                                                    date
                                                                                                                    MAE
                                                                                                                    Lanterne: {{ datemaxlanternemae|date('Y-m-d') }}</p>{% endif %}
                                                                                                                {% if datemincordemae %}
                                                                                                                    <p>
                                                                                                                    MIN
                                                                                                                    date
                                                                                                                    MAE
                                                                                                                    Corde: {{ datemincordemae|date('Y-m-d') }}
                                                                                                                    <->
                                                                                                                    MAX
                                                                                                                    date
                                                                                                                    MAE
                                                                                                                    Corde: {{ datemaxcordemae|date('Y-m-d') }}</p>{% endif %}
                                                                                                                {% if dateminpochemae %}
                                                                                                                    <p>
                                                                                                                    MIN
                                                                                                                    date
                                                                                                                    MAE
                                                                                                                    Poche: {{ dateminpochemae|date('Y-m-d') }}
                                                                                                                    <->
                                                                                                                    MAX
                                                                                                                    date
                                                                                                                    MAE
                                                                                                                    Poche: {{ datemaxpochemae|date('Y-m-d') }}</p>{% endif %}
                                                                                                            </div>
                                                                                                            {% for idSegment,segment in filiere.segment %}
                                                                                                                <ol class="dd-list"
                                                                                                                    style="display: inline-block">
                                                                                                                    <li class="dd-item"
                                                                                                                        data-id="{{ loop.index0 }}">
                                                                                                                        <div class="dd-handle">
                                                                                                                            {{ segment.nomSegment }}
                                                                                                                            {% if(segment.quantiterLanterne  + segment.nombreLanterne ) != 0 %}
                                                                                                                                <p>{{ segment.quantiterLanterne|number_format(0, ',', '.') }}
                                                                                                                                    u
                                                                                                                                    / {{ segment.nombreLanterne }}
                                                                                                                                    lanterne</p>
                                                                                                                                <p>{{ (segment.quantiterLanterne/12)|number_format(2, ',', '.') }}
                                                                                                                                    dz</p>
                                                                                                                                <p>{{ ((cycle.quantiterLanterne /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                                                    (dz
                                                                                                                                    *
                                                                                                                                    0.533)</p>
                                                                                                                            {% endif %}
                                                                                                                            {% if(segment.quantiterCorde  + segment.nombreCorde ) != 0 %}
                                                                                                                                <p>{{ segment.quantiterCorde|number_format(0, ',', '.') }}
                                                                                                                                    u
                                                                                                                                    / {{ segment.nombreCorde }}
                                                                                                                                    corde</p>
                                                                                                                                <p>{{ (segment.quantiterCorde/12)|number_format(2, ',', '.') }}
                                                                                                                                    dz</p>
                                                                                                                                <p>{{ ((cycle.quantiterCorde /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                                                    (dz
                                                                                                                                    *
                                                                                                                                    0.533)</p>
                                                                                                                            {% endif %}
                                                                                                                            {% if(segment.quantiterPoche  + segment.nombrePoche ) != 0 %}
                                                                                                                                <p>{{ segment.quantiterPoche|number_format(0, ',', '.') }}
                                                                                                                                    u
                                                                                                                                    / {{ segment.nombrePoche }}
                                                                                                                                    poche</p>
                                                                                                                                <p>{{ (segment.quantiterPoche/12)|number_format(2, ',', '.') }}
                                                                                                                                    dz</p>
                                                                                                                                <p>{{ ((cycle.quantiterPoche /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                                                    (dz
                                                                                                                                    *
                                                                                                                                    0.533)</p>
                                                                                                                            {% endif %}
                                                                                                                            {% set datemincordemae = null %}
                                                                                                                            {% set datemaxcordemae = null %}
                                                                                                                            {% set dateminlanternemae = null %}
                                                                                                                            {% set datemaxlanternemae = null %}
                                                                                                                            {% set dateminpochemae = null %}
                                                                                                                            {% set datemaxpochemae = null %}
                                                                                                                            {% for idFlotteur, flotteur in segment.flotteur %}
                                                                                                                                {% for idEmplacement,emplacement in flotteur.emplacement %}
                                                                                                                                    {% if emplacement.stockslanterne %}
                                                                                                                                        {% if dateminlanternemae %}
                                                                                                                                            {% if datemaxlanternemae < emplacement.dateDeRemplissage %}
                                                                                                                                                {% set datemaxlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                            {% elseif dateminlanternemae > emplacement.dateDeRemplissage %}
                                                                                                                                                {% set dateminlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                            {% endif %}
                                                                                                                                        {% else %}
                                                                                                                                            {% set dateminlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                            {% set datemaxlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                        {% endif %}
                                                                                                                                    {% elseif emplacement.stockscorde %}
                                                                                                                                        {% if emplacement.stockscorde.dateAssemblage %}
                                                                                                                                            {% if dateminpochemae %}
                                                                                                                                                {% if datemaxpochemae < emplacement.dateDeRemplissage %}
                                                                                                                                                    {% set datemaxpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                                {% elseif dateminpochemae > emplacement.dateDeRemplissage %}
                                                                                                                                                    {% set dateminpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                                {% endif %}
                                                                                                                                            {% else %}
                                                                                                                                                {% set dateminpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                                {% set datemaxpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                            {% endif %}
                                                                                                                                        {% else %}
                                                                                                                                            {% if datemincordemae %}
                                                                                                                                                {% if datemaxcordemae < emplacement.dateDeRemplissage %}
                                                                                                                                                    {% set datemaxcordemae = emplacement.dateDeRemplissage %}
                                                                                                                                                {% elseif datemincordemae > emplacement.dateDeRemplissage %}
                                                                                                                                                    {% set datemincordemae = emplacement.dateDeRemplissage %}
                                                                                                                                                {% endif %}
                                                                                                                                            {% else %}
                                                                                                                                                {% set datemincordemae = emplacement.dateDeRemplissage %}
                                                                                                                                                {% set datemaxcordemae = emplacement.dateDeRemplissage %}
                                                                                                                                            {% endif %}
                                                                                                                                        {% endif %}
                                                                                                                                    {% endif %}
                                                                                                                                {% endfor %}
                                                                                                                            {% endfor %}
                                                                                                                            {% if dateminlanternemae %}
                                                                                                                                <p>
                                                                                                                                MIN
                                                                                                                                date
                                                                                                                                MAE
                                                                                                                                Lanterne: {{ dateminlanternemae|date('Y-m-d') }}
                                                                                                                                <->
                                                                                                                                MAX
                                                                                                                                date
                                                                                                                                MAE
                                                                                                                                Lanterne: {{ datemaxlanternemae|date('Y-m-d') }}</p>{% endif %}
                                                                                                                            {% if datemincordemae %}
                                                                                                                                <p>
                                                                                                                                MIN
                                                                                                                                date
                                                                                                                                MAE
                                                                                                                                Corde: {{ datemincordemae|date('Y-m-d') }}
                                                                                                                                <->
                                                                                                                                MAX
                                                                                                                                date
                                                                                                                                MAE
                                                                                                                                Corde: {{ datemaxcordemae|date('Y-m-d') }}</p>{% endif %}
                                                                                                                            {% if dateminpochemae %}
                                                                                                                                <p>
                                                                                                                                MIN
                                                                                                                                date
                                                                                                                                MAE
                                                                                                                                Poche: {{ dateminpochemae|date('Y-m-d') }}
                                                                                                                                <->
                                                                                                                                MAX
                                                                                                                                date
                                                                                                                                MAE
                                                                                                                                Poche: {{ datemaxpochemae|date('Y-m-d') }}</p>{% endif %}
                                                                                                                        </div>
                                                                                                                        <ol class="dd-list"
                                                                                                                            style="display: inline-block"
                                                                                                                            id="{{ idFiliere }}{{ idSegment }}">
                                                                                                                            {% for idFlotteur, flotteur in segment.flotteur %}
                                                                                                                                <div class="col-xs-12 col-sm-12 col-md-12"
                                                                                                                                     id="{{ idFiliere }}{{ idSegment }}{{ idFlotteur }}">
                                                                                                                                    <li class="dd-item"
                                                                                                                                        data-id="{{ loop.index0 }}">
                                                                                                                                        <div class="col-xs-12 col-sm-12 col-md-12">
                                                                                                                                            {{ flotteur.nomFlotteur }}
                                                                                                                                            {% if(flotteur.quantiterLanterne  + flotteur.nombreLanterne ) != 0 %}
                                                                                                                                                <p>{{ flotteur.quantiterLanterne|number_format(0, ',', '.') }}
                                                                                                                                                    u
                                                                                                                                                    / {{ flotteur.nombreLanterne }}
                                                                                                                                                    lanterne</p>
                                                                                                                                                <p>{{ (flotteur.quantiterLanterne /12)|number_format(2, ',', '.') }}
                                                                                                                                                    dz</p>
                                                                                                                                                <p>{{ ((cycle.quantiterLanterne /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                                                                    (dz
                                                                                                                                                    *
                                                                                                                                                    0.533)</p>
                                                                                                                                            {% endif %}
                                                                                                                                            {% if(flotteur.quantiterCorde  + flotteur.nombreCorde ) != 0 %}
                                                                                                                                                <p>{{ flotteur.quantiterCorde|number_format(0, ',', '.') }}
                                                                                                                                                    u
                                                                                                                                                    / {{ flotteur.nombreCorde }}
                                                                                                                                                    corde</p>
                                                                                                                                                <p>{{ (flotteur.quantiterCorde/12)|number_format(2, ',', '.') }}
                                                                                                                                                    dz</p>
                                                                                                                                                <p>{{ ((cycle.quantiterCorde /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                                                                    (dz
                                                                                                                                                    *
                                                                                                                                                    0.533)</p>
                                                                                                                                            {% endif %}
                                                                                                                                            {% if(flotteur.quantiterPoche  + flotteur.nombrePoche ) != 0 %}
                                                                                                                                                <p>{{ flotteur.quantiterPoche|number_format(0, ',', '.') }}
                                                                                                                                                    u
                                                                                                                                                    / {{ flotteur.nombrePoche }}
                                                                                                                                                    poche</p>
                                                                                                                                                <p>{{ (flotteur.quantiterPoche/12)|number_format(2, ',', '.') }}
                                                                                                                                                    dz</p>
                                                                                                                                                <p>{{ ((cycle.quantiterPoche /12)* 0.533)|number_format(2, ',', '.') }}
                                                                                                                                                    (dz
                                                                                                                                                    *
                                                                                                                                                    0.533)</p>
                                                                                                                                            {% endif %}
                                                                                                                                            {% set datemincordemae = null %}
                                                                                                                                            {% set datemaxcordemae = null %}
                                                                                                                                            {% set dateminlanternemae = null %}
                                                                                                                                            {% set datemaxlanternemae = null %}
                                                                                                                                            {% set dateminpochemae = null %}
                                                                                                                                            {% set datemaxpochemae = null %}
                                                                                                                                            {% for idEmplacement,emplacement in flotteur.emplacement %}
                                                                                                                                                {% if emplacement.stockslanterne %}
                                                                                                                                                    {% if dateminlanternemae %}
                                                                                                                                                        {% if datemaxlanternemae < emplacement.dateDeRemplissage %}
                                                                                                                                                            {% set datemaxlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                                        {% elseif dateminlanternemae > emplacement.dateDeRemplissage %}
                                                                                                                                                            {% set dateminlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                                        {% endif %}
                                                                                                                                                    {% else %}
                                                                                                                                                        {% set dateminlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                                        {% set datemaxlanternemae = emplacement.dateDeRemplissage %}
                                                                                                                                                    {% endif %}
                                                                                                                                                {% elseif emplacement.stockscorde %}
                                                                                                                                                    {% if emplacement.stockscorde.dateAssemblage %}
                                                                                                                                                        {% if dateminpochemae %}
                                                                                                                                                            {% if datemaxpochemae < emplacement.dateDeRemplissage %}
                                                                                                                                                                {% set datemaxpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                                            {% elseif dateminpochemae > emplacement.dateDeRemplissage %}
                                                                                                                                                                {% set dateminpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                                            {% endif %}
                                                                                                                                                        {% else %}
                                                                                                                                                            {% set dateminpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                                            {% set datemaxpochemae = emplacement.dateDeRemplissage %}
                                                                                                                                                        {% endif %}
                                                                                                                                                    {% else %}
                                                                                                                                                        {% if datemincordemae %}
                                                                                                                                                            {% if datemaxcordemae < emplacement.dateDeRemplissage %}
                                                                                                                                                                {% set datemaxcordemae = emplacement.dateDeRemplissage %}
                                                                                                                                                            {% elseif datemincordemae > emplacement.dateDeRemplissage %}
                                                                                                                                                                {% set datemincordemae = emplacement.dateDeRemplissage %}
                                                                                                                                                            {% endif %}
                                                                                                                                                        {% else %}
                                                                                                                                                            {% set datemincordemae = emplacement.dateDeRemplissage %}
                                                                                                                                                            {% set datemaxcordemae = emplacement.dateDeRemplissage %}
                                                                                                                                                        {% endif %}
                                                                                                                                                    {% endif %}
                                                                                                                                                {% endif %}
                                                                                                                                            {% endfor %}
                                                                                                                                            {% if dateminlanternemae %}
                                                                                                                                                <p>
                                                                                                                                                MIN
                                                                                                                                                date
                                                                                                                                                MAE
                                                                                                                                                Lanterne: {{ dateminlanternemae|date('Y-m-d') }}
                                                                                                                                                <->
                                                                                                                                                MAX
                                                                                                                                                date
                                                                                                                                                MAE
                                                                                                                                                Lanterne: {{ datemaxlanternemae|date('Y-m-d') }}</p>{% endif %}
                                                                                                                                            {% if datemincordemae %}
                                                                                                                                                <p>
                                                                                                                                                MIN
                                                                                                                                                date
                                                                                                                                                MAE
                                                                                                                                                Corde: {{ datemincordemae|date('Y-m-d') }}
                                                                                                                                                <->
                                                                                                                                                MAX
                                                                                                                                                date
                                                                                                                                                MAE
                                                                                                                                                Corde: {{ datemaxcordemae|date('Y-m-d') }}</p>{% endif %}
                                                                                                                                            {% if dateminpochemae %}
                                                                                                                                                <p>
                                                                                                                                                MIN
                                                                                                                                                date
                                                                                                                                                MAE
                                                                                                                                                Poche: {{ dateminpochemae|date('Y-m-d') }}
                                                                                                                                                <->
                                                                                                                                                MAX
                                                                                                                                                date
                                                                                                                                                MAE
                                                                                                                                                Poche: {{ datemaxpochemae|date('Y-m-d') }}</p>{% endif %}
                                                                                                                                        </div>
                                                                                                                                        <div class="col-xs-12 col-sm-12 col-md-12">
                                                                                                                                            <table class="table table-bordered table-striped table-condensed">
                                                                                                                                                <tr>
                                                                                                                                                    <th>
                                                                                                                                                        place
                                                                                                                                                    </th>
                                                                                                                                                    <th>
                                                                                                                                                        article
                                                                                                                                                    </th>
                                                                                                                                                    <th>
                                                                                                                                                        lot
                                                                                                                                                    </th>
                                                                                                                                                    <th>
                                                                                                                                                        date
                                                                                                                                                        de
                                                                                                                                                        mise
                                                                                                                                                        en
                                                                                                                                                        eau
                                                                                                                                                    </th>
                                                                                                                                                    <th>
                                                                                                                                                        date
                                                                                                                                                        du
                                                                                                                                                        retrait
                                                                                                                                                    </th>
                                                                                                                                                    <th>
                                                                                                                                                        quantiter
                                                                                                                                                        total
                                                                                                                                                        /
                                                                                                                                                        u
                                                                                                                                                    </th>
                                                                                                                                                </tr>
                                                                                                                                                {% for idEmplacement,emplacement in flotteur.emplacement %}
                                                                                                                                                    <tr>
                                                                                                                                                        <td>{{ emplacement.place }}</td>
                                                                                                                                                        <td>
                                                                                                                                                            {% if emplacement.stockslanterne %}

                                                                                                                                                                {{ emplacement.stockslanterne.article.refStockArticle.refArticle.libArticle }}
                                                                                                                                                            {% elseif emplacement.stockscorde %}
                                                                                                                                                                {{ emplacement.stockscorde.article.refStockArticle.refArticle.libArticle }}
                                                                                                                                                            {% elseif emplacement.stockspoches %}
                                                                                                                                                                {{ emplacement.stockspoches.article.refStockArticle.refArticle.libArticle }}
                                                                                                                                                            {% endif %}
                                                                                                                                                        </td>
                                                                                                                                                        <td>
                                                                                                                                                            {% if emplacement.stockslanterne %}
                                                                                                                                                                {{ emplacement.stockslanterne.article.numeroSerie }}
                                                                                                                                                            {% elseif emplacement.stockscorde %}
                                                                                                                                                                {{ emplacement.stockscorde.article.numeroSerie }}
                                                                                                                                                            {% elseif emplacement.stockspoches %}
                                                                                                                                                                {{ emplacement.stockspoches.article.numeroSerie }}
                                                                                                                                                            {% endif %}
                                                                                                                                                        </td>
                                                                                                                                                        <td>{{ emplacement.dateDeRemplissage|date('Y-m-d') }}</td>
                                                                                                                                                        <td>
                                                                                                                                                            {% set dateDebut = emplacement.dateDeRemplissage|date("Y-m-d") %}
                                                                                                                                                            {% set date = emplacement.dateDeRemplissage|date("Y-m-d") %}
                                                                                                                                                            {% if emplacement.stockslanterne %}
                                                                                                                                                                {% set pro  = emplacement.stockslanterne.processus %}
                                                                                                                                                            {% elseif emplacement.stockscorde %}
                                                                                                                                                                {% set pro  = emplacement.stockscorde.processus %}
                                                                                                                                                            {% elseif emplacement.stockspoches %}
                                                                                                                                                                {% set pro  = emplacement.stockspoches.processus %}
                                                                                                                                                            {% endif %}
                                                                                                                                                            {% set date = date|date_modify(pro.duree.jours~"day")|date('Y-m-d') %}
                                                                                                                                                            {% set date = date|date_modify(pro.duree.mois~"month")|date('Y-m-d') %}
                                                                                                                                                            {% set date = date|date_modify(pro.duree.annee~"year")|date('Y-m-d') %}
                                                                                                                                                            {% if pro.idProcessusSuivant %}
                                                                                                                                                                {% if dateRecherche > date %}
                                                                                                                                                                    {% set trouve = false %}
                                                                                                                                                                    {% for proBase in processusBase if not trouve %}
                                                                                                                                                                        {% set pro = pro.idProcessusSuivant %}
                                                                                                                                                                        {% set date = date|date_modify(pro.duree.jours~"day")|date('Y-m-d') %}
                                                                                                                                                                        {% set date = date|date_modify(pro.duree.mois~"month")|date('Y-m-d') %}
                                                                                                                                                                        {% set date = date|date_modify(pro.duree.annee~"year")|date('Y-m-d') %}
                                                                                                                                                                        {% if pro.idProcessusSuivant %}
                                                                                                                                                                            {% if dateRecherche > date %}
                                                                                                                                                                                {% set trouve = false %}
                                                                                                                                                                            {% else %}
                                                                                                                                                                                {% set trouve = true %}
                                                                                                                                                                                {{ date|date('Y-m-d') }}
                                                                                                                                                                            {% endif %}
                                                                                                                                                                        {% else %}
                                                                                                                                                                            {% set trouve = true %}
                                                                                                                                                                            {{ date|date('Y-m-d') }} date de la fin du dernier cycle
                                                                                                                                                                        {% endif %}
                                                                                                                                                                    {% endfor %}
                                                                                                                                                                {% else %}
                                                                                                                                                                    {{ date|date('Y-m-d') }}
                                                                                                                                                                {% endif %}
                                                                                                                                                            {% else %}
                                                                                                                                                                {{ date|date('Y-m-d') }} date de la fin du dernier cycle
                                                                                                                                                            {% endif %}
                                                                                                                                                        </td>
                                                                                                                                                        <td>
                                                                                                                                                            {% if emplacement.stockslanterne %}
                                                                                                                                                                {% set somme = 0 %}
                                                                                                                                                                {% for poche in emplacement.stockslanterne.poches %}
                                                                                                                                                                    {% set somme = somme + poche.quantite %}
                                                                                                                                                                {% endfor %}
                                                                                                                                                                {{ somme }}
                                                                                                                                                            {% elseif emplacement.stockscorde %}
                                                                                                                                                                {{ emplacement.stockscorde.quantiter }}
                                                                                                                                                            {% elseif emplacement.stockspoches %}
                                                                                                                                                            {% endif %}
                                                                                                                                                        </td>

                                                                                                                                                    </tr>
                                                                                                                                                {% endfor %}
                                                                                                                                            </table>
                                                                                                                                        </div>
                                                                                                                                    </li>
                                                                                                                                </div>
                                                                                                                            {% endfor %}
                                                                                                                        </ol>
                                                                                                                    </li>
                                                                                                                </ol>
                                                                                                            {% endfor %}
                                                                                                        </li>
                                                                                                    {% endfor %}
                                                                                                </ol>
                                                                                            </div>
                                                                                            <div class="col-md-1">
                                                                                                <div class="custom-dd dd"
                                                                                                     id="nestable_list_1">
                                                                                                </div>
                                                                                            </div>
                                                                                        </td>
                                                                                    </tr>
                                                                                {% endif %}
                                                                            {% endfor %}
                                                                        {% endfor %}
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                            <script>
                                                                $(window).on('load', function () {
                                                                    // Accordion
                                                                    // -----------------------------------------------------------------
                                                                    $('#demo-foo-accordion-{{ idPhase }}').footable().on('footable_row_expanded', function (e) {
                                                                        $('#demo-foo-accordion-{{ idPhase }} tbody tr.footable-detail-show').not(e.row).each(function () {
                                                                            $('#demo-foo-accordion-{{ idPhase }}').data('footable').toggleDetail(this);
                                                                        });
                                                                    });

                                                                });
                                                            </script>
                                                            {% set defId  = defId + 1 %}

                                                            <div class="col-lg-12">
                                                                <div class="portlet"><!-- /primary heading -->
                                                                    <div class="portlet-heading">
                                                                        <h3 class="portlet-title text-dark">
                                                                            {{ phase.nomPhase }}
                                                                        </h3>
                                                                        <div class="portlet-widgets">
                                                                            <a href="javascript:;" data-toggle="reload"><i
                                                                                        class="ion-refresh"></i></a>
                                                                            <span class="divider"></span>
                                                                            <a data-toggle="collapse"
                                                                               data-parent="#accordion{{ idPhase }}"
                                                                               href="#portlet4"><i
                                                                                        class="ion-minus-round"></i></a>
                                                                            <span class="divider"></span>
                                                                        </div>
                                                                        <div class="clearfix"></div>
                                                                    </div>
                                                                    <div id="portlet{{ defId }}"
                                                                         class="panel-collapse collapse in">
                                                                        <div class="portlet-body">
                                                                            <div id="pie-chart{{ defId }}"
                                                                                 style="color:yellow">
                                                                                <div id="pie-chart-container{{ defId }}"
                                                                                     class="flot-chart"
                                                                                     style="height: 320px;">
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="row">

                                                            <div class="col-lg-12">
                                                                <div class="portlet">
                                                                    <!-- /primary heading -->
                                                                    <div class="portlet-heading">
                                                                        <h3 class="portlet-title text-dark">
                                                                            {{ phase.nomPhase }}
                                                                        </h3>
                                                                        <div class="portlet-widgets">
                                                                            <a href="javascript:;" data-toggle="reload"><i
                                                                                        class="ion-refresh"></i></a>
                                                                            <span class="divider"></span>
                                                                            <a data-toggle="collapse"
                                                                               data-parent="#accordion{{ idPhase }}"
                                                                               href="#bg-default{{ defId }}"><i
                                                                                        class="ion-minus-round"></i></a>
                                                                            <span class="divider"></span>
                                                                            <a href="#" data-toggle="remove"><i
                                                                                        class="ion-close-round"></i></a>
                                                                        </div>
                                                                        <div class="clearfix"></div>
                                                                    </div>
                                                                    <div id="bg-default{{ defId }}"
                                                                         class="panel-collapse collapse in">
                                                                        <div class="portlet-body">
                                                                            <div class="text-center">
                                                                                <ul class="list-inline chart-detail-list">
                                                                                    <li>
                                                                                        <h5>
                                                                                            <i class="fa fa-circle m-r-5"
                                                                                               style="color: #5fbeaa;"></i>Huitre
                                                                                        </h5>
                                                                                    </li>
                                                                                    <li>
                                                                                        <h5>
                                                                                            <i class="fa fa-circle m-r-5"
                                                                                               style="color: #5d9cec;"></i>Moule
                                                                                        </h5>
                                                                                    </li>
                                                                                    <li>
                                                                                        <h5>
                                                                                            <i class="fa fa-circle m-r-5"
                                                                                               style="color: #dcdcdc;"></i>Poche
                                                                                        </h5>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                            <div id="morris-bar-example{{ defId }}"
                                                                                 style="height: 300px;"></div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- /Portlet -->
                                                            </div>

                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}
                            {# end teste phases #}
                        </div>
                        <!-- end col -->
                    </div> <!-- end row -->
                </div> <!-- end card-box -->
            </div> <!-- end col -->
        </div>
        <!-- end Row -->

        {% block footer %}
            {{ parent() }}
        {% endblock %}
    {% endif %}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {% if(entity != null) %}
        <!--script for this page only-->
        <script src="{{ asset('bundles/ssfmb/plugins/nestable/jquery.nestable.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/pages/nestable.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/footable/js/footable.all.min.js') }}"></script>
        {#
                <script src="{{ asset('bundles/ssfmb/assets/js/bootstrap.min.js') }}"></script>
                <script src="{{ asset('bundles/ssfmb/assets/js/detect.js') }}"></script>
                <script src="{{ asset('bundles/ssfmb/assets/js/fastclick.js') }}"></script>
                <script src="{{ asset('bundles/ssfmb/assets/js/jquery.slimscroll.js') }}"></script>
                <script src="{{ asset('bundles/ssfmb/assets/js/jquery.blockUI.js') }}"></script>
                <script src="{{ asset('bundles/ssfmb/assets/js/waves.js') }}"></script>
                <script src="{{ asset('bundles/ssfmb/assets/js/wow.min.js') }}"></script>
                <script src="{{ asset('bundles/ssfmb/assets/js/jquery.nicescroll.js') }}"></script>
                <script src="{{ asset('bundles/ssfmb/assets/js/jquery.scrollTo.min.js') }}"></script>
        #}
        <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-select/js/bootstrap-select.min.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/ssfmb/pages/jquery.footable.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/js/processus.js') }}"></script>

        <script src="{{ asset('bundles/ssfmb/plugins/morris/morris.min.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/raphael/raphael-min.js') }}"></script>

        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.min.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.time.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.tooltip.min.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.resize.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.pie.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.selection.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.stack.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.orderBars.min.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.crosshair.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/pages/jquery.flot.init.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/pages/morris.init.js') }}"></script>
    {% endif %}
{% endblock %}
