{% extends "::base.html.twig" %}
{% block title %}Processus - {{ parent() }}{% endblock %}
{% block stylesheet %}
    {% if(entity != null) %}
        <link href="{{ asset('bundles/ssfmb/plugins/footable/css/footable.core.css') }}" rel="stylesheet">
        <link href="{{ asset('bundles/ssfmb/plugins/bootstrap-select/css/bootstrap-select.min.css') }}"
              rel="stylesheet"/>
        <link href="{{ asset('bundles/ssfmb/plugins/nestable/jquery.nestable.css') }}" rel="stylesheet"/>
        <link href="{{ asset('bundles/ssfmb/css/backToTop.css') }}" rel="stylesheet"/>
        {{ parent() }}
    {% endif %}
{% endblock %}
{% block header %} {{ parent() }}{% endblock %}
{% block body %}
    {{ parent() }}
    {% set page = 'suivit' %}
    {% if(entity != null) %}

        <div class="row">
            <div class="col-sm-12">
                <div class="card-box">
                    <div class="row">
                        <div class="col-md-12">
                            <h4 class="m-t-0 header-title"><b>Processus de grocissement {{ entity.abrevMagasin }}</b>
                            </h4>
                            <p class="text-muted m-b-30 font-13">
                            </p>
                            {% if(entity != null) %}
                                {% include('@SSFMB/Default/Include/processus/pregrossissement.html.twig') %}
                                {% include('@SSFMB/Default/Include/processus/grossissement.html.twig') %}
                                {#
                                     {% include('@SSFMB/Default/Include/processus/comerciale.html.twig') %}
                                 #}
                            {% endif %}
                        </div>
                        <!-- end col -->
                    </div> <!-- end row -->
                </div> <!-- end card-box -->
            </div> <!-- end col -->
        </div>
        <!-- end Row -->

        {% block footer %}
            {{ parent() }}
        {% endblock %}
    {% endif %}
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    {% if(entity != null) %}
        <!--script for this page only-->
        <script src="{{ asset('bundles/ssfmb/plugins/nestable/jquery.nestable.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/pages/nestable.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/footable/js/footable.all.min.js') }}"></script>

        <script src="{{ asset('bundles/ssfmb/plugins/bootstrap-select/js/bootstrap-select.min.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/ssfmb/pages/jquery.footable.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/js/processus.js') }}"></script>

        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.min.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.time.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.tooltip.min.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.resize.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.pie.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.selection.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.stack.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.orderBars.min.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/plugins/flot-chart/jquery.flot.crosshair.js') }}"></script>
        <script src="{{ asset('bundles/ssfmb/pages/jquery.flot.init.js') }}"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                function diffdate(d1, d2, u) {
                    div = 1
                    switch (u) {
                        case 's':
                            div = 1000;
                            break;
                        case 'm':
                            div = 1000 * 60
                            break;
                        case 'h':
                            div = 1000 * 60 * 60
                            break;
                        case 'd':
                            div = 1000 * 60 * 60 * 24
                            break;
                    }
                    var Diff = d2.getTime() - d1.getTime();
                    return Math.ceil((Diff / div))
                }

                $('.dateemplacement').each(function (ele, val) {
                    console.log(ele + "     " + val)
                    var datejour = $(this).text().split("-");
                    var Date1 = new Date(datejour[0], datejour[1] - 1, datejour[2]);
                    var Date2 = new Date();
                    if ($(this).parent('.flotteur').has('dateemplacement'))
                        if (0 < diffdate(Date1, Date2, 'd') < 10) {
                            if ($(this).parent('.flotteur').has('dateemplacement'))
                                var str = 'il reste ' + diffdate(Date1, Date2, 'd') + ' jours pour l article de la filiere ' + $(this).parent() + ' contenu dans le segment ' + $('.segment').text() + ' a partir du flotteur ' + $('.flotteur').text() + ' a lemplacement ' + $('.emplacement').text() + '<br>'
                            $('#alertejaune').html('<button type="button" class="close" data-dismiss="alert" aria-hidden="true">× </button> <h4> Alert! </h4> <strong>Warning!</strong> ' + str + '<a href="#" class="alert-link">alert link</a>');
                            $('#alertejaune').show();
                        }
                    if (diffdate(Date1, Date2, 'd') <= 0) {
                        var str2 = 'il reste ' + (diffdate(Date1, Date2, 'd') * -1) + ' jours pour l article de la filiere ' + $('#filiere').text() + ' contenu dans le segment ' + $('#segment').text() + ' a partir du flotteur ' + $('#flotteur').text() + ' a lemplacement ' + $('#emplacement').text()
                        $('#alerterouge').html('<button type="button" class="close" data-dismiss="alert" aria-hidden="true">× </button> <h4> Alert! </h4> <strong>Warning!</strong> ' + str2 + '<a href="#" class="alert-link">alert link</a>');
                        $('#alerterouge').show();
                    }
                });
            });
        </script>
    {% endif %}
{% endblock %}
